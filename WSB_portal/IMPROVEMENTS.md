# Предложения по улучшению WSB Portal

## Функциональные улучшения

### 1. Регистрация новых пользователей
**Приоритет:** Высокий  
**Статус:** ✅ Реализовано (страница `/register`, API `POST /auth/register`, регистрация по Telegram ID, проверки дубликатов, инструкция по получению ID)  
**Описание:** Добавить возможность регистрации новых пользователей через веб-интерфейс с подтверждением email/телефона.  
**Реализация:** (дополнительно возможны подтверждения email/SMS и двухфакторная проверка)

### 2. Уведомления о бронированиях
**Приоритет:** Высокий  
**Статус:** ✅ Реализовано (email при создании/отмене, уведомления администраторам, настройки пользователя, групповые напоминания за 15 минут)  
**Описание:** Реализовать систему уведомлений о создании, изменении и отмене бронирований.  
**Реализация:** SMS-уведомления остаются опциональными (через внешний сервис)

### 3. Календарь бронирований
**Приоритет:** Средний  
**Статус:** В процессе  
**Описание:** Создать вкладку с календарным представлением бронирований на месяц для удобного просмотра занятости оборудования.

### 4. Экспорт отчетов
**Приоритет:** Средний  
**Статус:** В процессе  
**Что сделано:** Добавлен экспорт бронирований (CSV) на вкладке «Управление бронированием», эндпоинт `/api/bookings/export`, кнопка «Экспорт CSV» (админы выгружают все брони, пользователи — свои).  
**Следующие шаги:**
- Экспорт таблиц дашборда и статистики (CSV/XLSX, возможно PDF)
- Экспорт данных модуля СИ
- Расширение API для программного экспорта (фильтры, диапазоны)

### 5. Фильтры и поиск в модуле СИ
**Приоритет:** Средний  
**Описание:** Улучшить поиск и фильтрацию оборудования в модуле СИ.  
**Реализация:**
- Поиск по наименованию, номеру, изготовителю
- Фильтры по типу, статусу поверки, дате поверки
- Сортировка по различным полям
- Сохранение пользовательских фильтров

### 6. Сопоставление оборудования между БД
**Приоритет:** Средний  
**Описание:** Реализовать связь между оборудованием в БД RM и БД equipment для корректного отображения названий.  
**Реализация:**
- Таблица сопоставления `equipment_mapping` в БД RM
- API для управления сопоставлением (только для админов)
- Автоматическое использование правильных названий из БД equipment при отображении бронирований
- Интерфейс для редактирования сопоставлений

### 7. Расширенное управление пользователями
**Приоритет:** Низкий  
**Описание:** Улучшить функциональность управления пользователями на 5-й вкладке.  
**Реализация:**
- Массовые операции (блокировка/разблокировка нескольких пользователей)
- Фильтры и поиск по пользователям (по имени, телефону, email, статусу)
- История действий пользователя (логи бронирований, изменений)
- Экспорт списка пользователей в Excel/CSV
- Статистика по пользователям (количество бронирований, активность)
- Назначение ролей (расширение системы прав помимо админа)

### 7. Календарь бронирований
**Приоритет:** Средний  
**Описание:** Добавить календарный вид бронирований для удобного просмотра занятости.  
**Реализация:**
- Календарный вид на вкладке "Управление бронированием"
- Выделение дней с активными бронированиями
- Клик по дню для просмотра деталей
- Интеграция с тепловой картой (переход к дате из календаря)

### 8. Повторяющиеся бронирования
**Приоритет:** Низкий  
**Описание:** Возможность создавать регулярные (еженедельные, ежемесячные) бронирования.  
**Реализация:**
- Опция "Повторять" в форме бронирования
- Выбор периодичности (ежедневно, еженедельно, ежемесячно)
- Выбор конечной даты или количества повторений
- Массовая отмена повторяющихся бронирований

### 9. История изменений бронирований
**Приоритет:** Низкий  
**Описание:** Ведение лога всех изменений бронирований (создание, изменение, отмена).  
**Реализация:**
- Таблица `booking_history` в БД RM
- Отображение истории в детальном просмотре бронирования
- Аудит-логи для администраторов

### 10. Интеграция с Telegram-ботом
**Приоритет:** Средний  
**Описание:** Синхронизация данных между веб-порталом и Telegram-ботом.  
**Реализация:**
- Общий API для создания/отмены бронирований
- Синхронизация пользователей (привязка Telegram ID к веб-аккаунту)
- Единая точка входа для уведомлений

### 11. Статистика использования оборудования
**Приоритет:** Низкий  
**Описание:** Расширенная аналитика по использованию оборудования.  
**Реализация:**
- Графики популярности оборудования
- Статистика по пользователям (кто чаще всего бронирует)
- Прогнозирование загрузки на основе исторических данных
- Рекомендации по оптимизации расписания

## Визуальные улучшения

### 1. Адаптивный дизайн (для планшетов)
**Приоритет:** Низкий  
**Статус:** Решено не разрабатывать отдельную мобильную версию  
**Обоснование:** 
- Telegram-бот уже покрывает мобильные сценарии (быстрое бронирование, уведомления)
- Веб-версия доступна только в корпоративной сети, мобильные устройства обычно вне сети
- Затраты на разработку не оправданы
- Текущая базовая адаптивность достаточна для планшетов
**Реализация (опционально, только для планшетов):**
- Улучшение существующих медиа-запросов для планшетов
- Оптимизация таблиц для средних экранов
- Базовая поддержка больших смартфонов (без специальной оптимизации)

### 2. Темная тема
**Приоритет:** Низкий  
**Описание:** Добавить переключатель темной/светлой темы.  
**Реализация:**
- CSS-переменные для цветов
- Переключатель темы в шапке
- Сохранение выбора в localStorage
- Плавные переходы между темами

### 3. Анимации и переходы
**Приоритет:** Низкий  
**Описание:** Добавить плавные анимации для улучшения UX.  
**Реализация:**
- Плавное переключение вкладок
- Анимация загрузки данных
- Плавное появление модальных окон
- Индикаторы прогресса для длительных операций

### 4. Улучшение тепловых карт
**Приоритет:** Средний  
**Описание:** Расширить функциональность тепловых карт.  
**Реализация:**
- Клик по ячейке для просмотра деталей бронирования
- Подсветка текущего времени
- Фильтрация по статусам бронирований
- Экспорт тепловой карты в изображение

### 5. Интерактивные подсказки
**Приоритет:** Низкий  
**Описание:** Добавить контекстные подсказки для новых пользователей.  
**Реализация:**
- Tooltips для кнопок и полей
- Тур по интерфейсу для новых пользователей
- Справка в виде модальных окон
- Видео-инструкции (опционально)

### 6. Улучшение таблиц
**Приоритет:** Средний  
**Описание:** Сделать таблицы более удобными и информативными.  
**Реализация:**
- Пагинация для больших таблиц
- Сортировка по клику на заголовок
- Выделение строк при наведении
- Группировка данных (например, по датам)
- Экспорт таблиц в Excel/CSV

### 7. Дашборд с виджетами
**Приоритет:** Низкий  
**Описание:** Сделать дашборд настраиваемым с виджетами.  
**Реализация:**
- Drag-and-drop для перестановки виджетов
- Настройка отображаемых графиков
- Сохранение пользовательских настроек
- Различные размеры виджетов

### 8. Улучшение формы бронирования
**Приоритет:** Средний  
**Описание:** Сделать форму более интуитивной и информативной.  
**Реализация:**
- Валидация в реальном времени
- Подсказки о доступности слотов
- Предпросмотр бронирования перед подтверждением
- Сохранение черновиков бронирований

## Технические улучшения

### 1. Кеширование данных
**Приоритет:** Высокий  
**Статус:** ✅ Реализовано (Redis 5.2, 256 MB; кешируются тепловые карты, дашборд, каталоги бронирования и модуль СИ; инвалидация после изменений)  
**Описание:** Добавить кеширование для улучшения производительности.  
**Предстоящее развитие:** мониторинг hit-rate, алерты при недоступности Redis, возможность динамической настройки TTL из админки.

### 2. Оптимизация запросов к БД
**Приоритет:** Высокий  
**Статус:** ✅ Реализовано  
**Что сделано:** ограничен стартовый диапазон дашборда последними 90 днями; запросы `/api/dashboard` фильтруют данные на уровне SQL; скрипт `scripts/create_indexes.py` создаёт индексы для `bookings` (RM) и ключевых таблиц БД `equipment`; запросы `get_equipment_by_type` и `get_gosregister` выбирают только используемые столбцы.  
**Следующие шаги:**
- Пагинация/лимиты для очень больших выборок и экспортов
- Connection pooling и prepared statements для горячих эндпоинтов
- Мониторинг длительных запросов и алерты по отклонениям

### 3. Логирование и мониторинг
**Приоритет:** Средний  
**Описание:** Улучшить систему логирования и мониторинга.  
**Реализация:**
- Структурированное логирование (JSON)
- Логирование всех API-запросов
- Мониторинг производительности (время ответа)
- Алерты при ошибках БД

### 4. Тестирование
**Приоритет:** Средний  
**Описание:** Добавить автоматические тесты.  
**Реализация:**
- Unit-тесты для сервисов
- Интеграционные тесты для API
- E2E-тесты для критических сценариев
- CI/CD pipeline для автоматического запуска тестов

### 5. Безопасность
**Приоритет:** Высокий  
**Описание:** Усилить безопасность приложения.  
**Реализация:**
- Rate limiting для API
- Защита от CSRF-атак
- Валидация всех входных данных
- Шифрование чувствительных данных
- Регулярное обновление зависимостей

### 6. Docker и деплой
**Приоритет:** Средний  
**Описание:** Подготовить контейнеризацию и автоматический деплой.  
**Реализация:**
- Dockerfile для приложения
- docker-compose для полного стека (app + PostgreSQL + Redis)
- CI/CD для автоматического деплоя
- Health checks для контейнеров

### 7. API документация
**Приоритет:** Средний  
**Описание:** Создать полную документацию API.  
**Реализация:**
- OpenAPI/Swagger спецификация
- Интерактивная документация (Swagger UI)
- Примеры запросов и ответов
- Описание ошибок и кодов ответов

### 8. Обработка ошибок
**Приоритет:** Средний  
**Описание:** Улучшить обработку и отображение ошибок.  
**Реализация:**
- Централизованная обработка ошибок
- Понятные сообщения об ошибках для пользователей
- Логирование ошибок с контекстом
- Отправка критических ошибок администраторам

## Приоритизация

### Критичные (сделать в первую очередь)
1. ✅ Регистрация новых пользователей
2. ✅ Уведомления о бронированиях
3. ~~Адаптивный дизайн~~ (решено не разрабатывать отдельную мобильную версию)
4. ✅ Кеширование данных
5. ✅ Оптимизация запросов к БД

### Важные (следующий этап)
1. Экспорт отчетов
2. Фильтры и поиск в модуле СИ
3. Сопоставление оборудования между БД
4. Календарь бронирований
5. Безопасность

### Желательные (по возможности)
1. Повторяющиеся бронирования
2. Темная тема
3. Анимации и переходы
4. Дашборд с виджетами
5. Интеграция с Telegram-ботом

