# ะััะตั ะพะฑ ะธะฝัะตะณัะฐัะธะธ ัะตะปะตะณัะฐะผ-ะฑะพัะฐ ะฒ ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต

**ะะฐัะฐ:** 2025-12-17  
**ะะตััะธั ัะธััะตะผั:** 1.4.24  
**ะะฒัะพั:** AI ะััะธััะตะฝั (Cursor)

---

## ๐ฏ ะฆะตะปั ะธะฝัะตะณัะฐัะธะธ

ะะฑัะตะดะธะฝะธัั ัะตะปะตะณัะฐะผ-ะฑะพั ั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะตะผ ะฝะฐ ะพะดะฝะพะผ ัะดัะต (Flask) ะดะปั:
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธั ะพะฑัะตะณะพ ะฟัะปะฐ ะฟะพะดะบะปััะตะฝะธะน ะบ ะะ
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธั ะพะฑัะธั ััะฝะบัะธะน ัะฐะฑะพัั ั ะะ (execute_query)
- โ ะฃะผะตะฝััะตะฝะธั ะดัะฑะปะธัะพะฒะฐะฝะธั ะบะพะดะฐ
- โ ะฃะฟัะพัะตะฝะธั ัะฐะทะฒะตัััะฒะฐะฝะธั (ะพะดะธะฝ ะฟัะพัะตัั ะฒะผะตััะพ ะดะฒัั)
- โ ะกะฝะธะถะตะฝะธั "ะฒะตัะฐ" ะฟัะพะณัะฐะผะผั

---

## ๐ ะัะฟะพะปะฝะตะฝะฝัะต ะธะทะผะตะฝะตะฝะธั

### 1. ะกะพะทะดะฐะฝ ะผะพะดัะปั `telegram_bot.py`

**ะััั:** `web_app_WebChip/telegram_bot.py`

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะัะฟะพะปัะทัะตั ััะฝะบัะธั `execute_query` ะธะท `app.py` ะฒะผะตััะพ ะฟััะผะพะณะพ ะฟะพะดะบะปััะตะฝะธั ะบ ะะ
- ะัะฟะพะปัะทัะตั ะพะฑัะธะน ะฟัะป ะฟะพะดะบะปััะตะฝะธะน ะบ ะะ
- ะัะฟะพะปัะทัะตั ะพะฑัะธะน ะปะพะณะณะตั Flask ะฟัะธะปะพะถะตะฝะธั
- ะะฐะฟััะบะฐะตััั ะฒ ะพัะดะตะปัะฝะพะผ ะฟะพัะพะบะต (daemon thread)
- ะะพะฑะฐะฒะปะตะฝะฐ ะฒะฐะปะธะดะฐัะธั ะดะปะธะฝั ะทะฐะฟัะพัะฐ (max 100 ัะธะผะฒะพะปะพะฒ)

**ะคัะฝะบัะธะธ:**
- `init_telegram_bot(flask_app, execute_query_func)` - ะธะฝะธัะธะฐะปะธะทะฐัะธั ะฑะพัะฐ
- `start_bot_polling(bot)` - ะทะฐะฟััะบ ะฑะพัะฐ ะฒ ะพัะดะตะปัะฝะพะผ ะฟะพัะพะบะต

### 2. ะะฝัะตะณัะธัะพะฒะฐะฝ ะฒ `app.py`

**ะะทะผะตะฝะตะฝะธั:**
- ะะพะฑะฐะฒะปะตะฝะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธั ัะตะปะตะณัะฐะผ-ะฑะพัะฐ ะฟัะธ ััะฐััะต ะฟัะธะปะพะถะตะฝะธั
- ะะพั ะทะฐะฟััะบะฐะตััั ะฒ ะพัะดะตะปัะฝะพะผ daemon-ะฟะพัะพะบะต
- ะัะปะธ ัะพะบะตะฝ ะฝะต ัะบะฐะทะฐะฝ ะธะปะธ ะฟัะพะธะทะพัะปะฐ ะพัะธะฑะบะฐ, ะฟัะธะปะพะถะตะฝะธะต ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัั ะฑะตะท ะฑะพัะฐ

**ะะพะด ะธะฝะธัะธะฐะปะธะทะฐัะธะธ:**
```python
# ะะฝะธัะธะฐะปะธะทะฐัะธั ัะตะปะตะณัะฐะผ-ะฑะพัะฐ (ะตัะปะธ ัะพะบะตะฝ ัะบะฐะทะฐะฝ)
try:
    from telegram_bot import init_telegram_bot, start_bot_polling
    telegram_bot = init_telegram_bot(_flask_app, execute_query)
    if telegram_bot:
        start_bot_polling(telegram_bot)
        _flask_app.logger.info("ะขะตะปะตะณัะฐะผ-ะฑะพั ะธะฝัะตะณัะธัะพะฒะฐะฝ ะธ ะทะฐะฟััะตะฝ")
except ImportError as e:
    _flask_app.logger.warning(f"ะะต ัะดะฐะปะพัั ะทะฐะณััะทะธัั ะผะพะดัะปั telegram_bot: {e}. ะขะตะปะตะณัะฐะผ-ะฑะพั ะฝะต ะฑัะดะตั ะทะฐะฟััะตะฝ.")
except Exception as e:
    _flask_app.logger.error(f"ะัะธะฑะบะฐ ะฟัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ัะตะปะตะณัะฐะผ-ะฑะพัะฐ: {e}", exc_info=True)
```

### 3. ะะฑะฝะพะฒะปะตะฝ `requirements.txt`

**ะะพะฑะฐะฒะปะตะฝะพ:**
- `pyTelegramBotAPI>=4.16.1` - ะฑะธะฑะปะธะพัะตะบะฐ ะดะปั ัะฐะฑะพัั ั Telegram Bot API

### 4. ะฃะฟัะพัะตะฝ `Dockerfile`

**ะะทะผะตะฝะตะฝะธั:**
- ะฃะฑัะฐะฝ Supervisor (ะฑะพะปััะต ะฝะต ะฝัะถะตะฝ)
- ะะดะธะฝ ะฟัะพัะตัั ะฒะผะตััะพ ะดะฒัั
- ะฃััะฐะฝะพะฒะปะตะฝ curl ะดะปั healthcheck
- ะะฐะฟััะบ ัะตัะตะท `python app.py` (ะพะดะธะฝ ะฟัะพัะตัั)

### 5. ะะฑะฝะพะฒะปะตะฝ `docker-compose.yml`

**ะะทะผะตะฝะตะฝะธั:**
- ะฃะฟัะพัะตะฝ ะพัะฝะพะฒะฝะพะน ัะตัะฒะธั `crystal_wafer_app`
- ะฃะฑัะฐะฝั volumes ะดะปั supervisor_logs
- ะะดะธะฝ ะบะพะฝัะตะนะฝะตั ะดะปั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั ะธ ัะตะปะตะณัะฐะผ-ะฑะพัะฐ

---

## โ ะัะตะธะผััะตััะฒะฐ ะฝะพะฒะพะน ะฐััะธัะตะบัััั

### 1. ะะฑัะธะน ะฟัะป ะฟะพะดะบะปััะตะฝะธะน ะบ ะะ
- โ ะะฑะฐ ะบะพะผะฟะพะฝะตะฝัะฐ ะธัะฟะพะปัะทััั ะพะดะธะฝ ะฟัะป ะฟะพะดะบะปััะตะฝะธะน
- โ ะะตะฝััะต ะฟะพะดะบะปััะตะฝะธะน ะบ ะะ
- โ ะัััะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### 2. ะะฑัะธะต ััะฝะบัะธะธ ะะ
- โ ะะตั ะดัะฑะปะธัะพะฒะฐะฝะธั ะบะพะดะฐ SQL ะทะฐะฟัะพัะพะฒ
- โ ะะดะธะฝะฐั ัะพัะบะฐ ะปะพะณะธัะพะฒะฐะฝะธั ะทะฐะฟัะพัะพะฒ
- โ ะะดะธะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

### 3. ะฃะฟัะพัะตะฝะฝะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต
- โ ะะดะธะฝ ะฟัะพัะตัั ะฒะผะตััะพ ะดะฒัั
- โ ะะต ะฝัะถะตะฝ Supervisor
- โ ะัะพัะต ัะฟัะฐะฒะปะตะฝะธะต

### 4. ะะตะฝััะธะน "ะฒะตั" ะฟัะพะณัะฐะผะผั
- โ ะะฑัะธะต ะทะฐะฒะธัะธะผะพััะธ
- โ ะะตะฝััะต ะฟัะพัะตััะพะฒ
- โ ะะตะฝััะต ะฟะพััะตะฑะปะตะฝะธะต ะฟะฐะผััะธ

### 5. ะฃะปัััะตะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
- โ ะัะต ะปะพะณะธ ัะตัะตะท Flask logger
- โ ะะดะธะฝัะน ัะพัะผะฐั ะปะพะณะพะฒ
- โ ะกัััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต

---

## ๐ ะะธะณัะฐัะธั ั ะฟัะตะดัะดััะตะน ะฒะตััะธะธ

### ะงัะพ ะธะทะผะตะฝะธะปะพัั

1. **ะขะตะปะตะณัะฐะผ-ะฑะพั ะฑะพะปััะต ะฝะต ะพัะดะตะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต:**
   - ะฃะดะฐะปะตะฝะฐ ะฟะฐะฟะบะฐ `telegram_bot_HMCB/` (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะผะพะถะฝะพ ะพััะฐะฒะธัั ะดะปั ะธััะพัะธะธ)
   - ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั ะฟะตัะตะฝะตัะตะฝะฐ ะฒ `web_app_WebChip/telegram_bot.py`

2. **Docker ะบะพะฝัะธะณััะฐัะธั:**
   - ะะพะปััะต ะฝะต ะฝัะถะตะฝ `Dockerfile.combined`
   - ะะพะปััะต ะฝะต ะฝัะถะตะฝ `docker/supervisord.conf`
   - ะัะฟะพะปัะทัะตััั ะฟัะพััะพะน `Dockerfile`

3. **ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:**
   - ะขะต ะถะต ัะฐะผัะต: `TELEGRAM_BOT_TOKEN` ะฒ `.env`

### ะงัะพ ะพััะฐะปะพัั ะฑะตะท ะธะทะผะตะฝะตะฝะธะน

- ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั ัะตะปะตะณัะฐะผ-ะฑะพัะฐ ะฝะต ะธะทะผะตะฝะธะปะฐัั
- SQL ะทะฐะฟัะพัั ะพััะฐะปะธัั ัะต ะถะต
- ะะฝัะตััะตะนั ะฑะพัะฐ ะพััะฐะปัั ะฟัะตะถะฝะธะผ

---

## ๐ ะะฐะฟััะบ

### ะะพะบะฐะปัะฝะพ

```bash
cd web_app_WebChip
python app.py
```

ะขะตะปะตะณัะฐะผ-ะฑะพั ะทะฐะฟัััะธััั ะฐะฒัะพะผะฐัะธัะตัะบะธ, ะตัะปะธ ัะบะฐะทะฐะฝ `TELEGRAM_BOT_TOKEN` ะฒ `.env`.

### ะ Docker

```bash
docker-compose up -d crystal_wafer_app
```

---

## ๐ ะกัะฐะฒะฝะตะฝะธะต ะฐััะธัะตะบััั

### ะะพ ะธะฝัะตะณัะฐัะธะธ

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   Supervisor        โ
โโโโโโโโโโโโโโโโโโโโโโโค
โ 1. Flask app        โ  โ ะัะดะตะปัะฝัะน ะฟัะพัะตัั
โ 2. Telegram bot     โ  โ ะัะดะตะปัะฝัะน ะฟัะพัะตัั
โโโโโโโโโโโโโโโโโโโโโโโ
     โ         โ
     โโโโโโฌโโโโโ
          โ
     โโโโโโผโโโโโ
     โ   ะะ    โ  โ ะะฒะฐ ะฟัะปะฐ ะฟะพะดะบะปััะตะฝะธะน
     โโโโโโโโโโโ
```

### ะะพัะปะต ะธะฝัะตะณัะฐัะธะธ

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ   Flask app         โ
โ  โโโโโโโโโโโโโโโโโ  โ
โ  โ Telegram bot  โ  โ  โ Daemon thread
โ  โโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโฌโโโโโโโโโโโโ
          โ
     โโโโโโผโโโโโ
     โ   ะะ    โ  โ ะะดะธะฝ ะฟัะป ะฟะพะดะบะปััะตะฝะธะน
     โโโโโโโโโโโ
```

---

## โ๏ธ ะะฐะถะฝัะต ะทะฐะผะตัะฐะฝะธั

1. **ะขะตะปะตะณัะฐะผ-ะฑะพั ะพะฟัะธะพะฝะฐะปะตะฝ:**
   - ะัะปะธ `TELEGRAM_BOT_TOKEN` ะฝะต ัะบะฐะทะฐะฝ, ะฟัะธะปะพะถะตะฝะธะต ัะฐะฑะพัะฐะตั ะฑะตะท ะฑะพัะฐ
   - ะัะธะฑะบะธ ะฟัะธ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ ะฑะพัะฐ ะฝะต ะพััะฐะฝะฐะฒะปะธะฒะฐัั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต

2. **Daemon thread:**
   - ะขะตะปะตะณัะฐะผ-ะฑะพั ะทะฐะฟััะบะฐะตััั ะฒ daemon-ะฟะพัะพะบะต
   - ะัะธ ะทะฐะฒะตััะตะฝะธะธ ะพัะฝะพะฒะฝะพะณะพ ะฟัะพัะตััะฐ ะฑะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฒะตััะธััั

3. **ะะพะณะธัะพะฒะฐะฝะธะต:**
   - ะัะต ะปะพะณะธ ัะตะปะตะณัะฐะผ-ะฑะพัะฐ ะธะดัั ัะตัะตะท Flask logger
   - ะัะฟะพะปัะทัะตััั ััััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต (ะตัะปะธ ะฝะฐัััะพะตะฝะพ)

---

## ๐ ะขะตััะธัะพะฒะฐะฝะธะต

### ะัะพะฒะตัะบะฐ ัะฐะฑะพัั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธั

```bash
curl http://localhost:8089/
```

### ะัะพะฒะตัะบะฐ ัะฐะฑะพัั ัะตะปะตะณัะฐะผ-ะฑะพัะฐ

1. ะะฐะนะดะธัะต ะฑะพัะฐ ะฒ Telegram
2. ะัะฟัะฐะฒััะต ะบะพะผะฐะฝะดั `/start`
3. ะัะฟัะฐะฒััะต ัะธัั ะบัะธััะฐะปะปะฐ (ะฝะฐะฟัะธะผะตั, `HJB313`)

### ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ

```bash
# ะัะต ะปะพะณะธ
docker-compose logs -f crystal_wafer_app

# ะขะพะปัะบะพ ะปะพะณะธ Flask
docker exec crystal_wafer_app_container tail -f logs/app.log
```

---

## ๐ ะะตะบะพะผะตะฝะดะฐัะธะธ

1. **ะัะปะธ ะฝัะถะตะฝ ัะพะปัะบะพ ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ะฑะตะท ะฑะพัะฐ:**
   - ะะต ัะบะฐะทัะฒะฐะนัะต `TELEGRAM_BOT_TOKEN` ะฒ `.env`
   - ะะปะธ ะธัะฟะพะปัะทัะนัะต ะฟัะพัะธะปั `web-only` ะฒ docker-compose

2. **ะัะปะธ ะฝัะถะตะฝ ัะพะปัะบะพ ัะตะปะตะณัะฐะผ-ะฑะพั:**
   - ะะตะบะพะผะตะฝะดัะตััั ะฒัะต ัะฐะฒะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต (ะพะฝะพ ัะพะดะตัะถะธั ััะฝะบัะธะธ ะะ)
   - ะะพะถะฝะพ ัะพะทะดะฐัั ะพัะดะตะปัะฝัะน endpoint ะดะปั healthcheck

3. **ะะพะฝะธัะพัะธะฝะณ:**
   - ะะพะฝะธัะพัััะต ะปะพะณะธ Flask ะฟัะธะปะพะถะตะฝะธั
   - ะัะพะฒะตััะนัะต, ััะพ ัะตะปะตะณัะฐะผ-ะฑะพั ะทะฐะฟััะตะฝ (ัะพะพะฑัะตะฝะธะต ะฒ ะปะพะณะฐั)

---

## โ ะัะพะณ

ะะฝัะตะณัะฐัะธั ัะตะปะตะณัะฐะผ-ะฑะพัะฐ ะฒ ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะต ััะฟะตัะฝะพ ะทะฐะฒะตััะตะฝะฐ. ะะพะฒะฐั ะฐััะธัะตะบัััะฐ:
- โ ะัะฟะพะปัะทัะตั ะพะฑัะธะน ะฟัะป ะฟะพะดะบะปััะตะฝะธะน ะบ ะะ
- โ ะัะฟะพะปัะทัะตั ะพะฑัะธะต ััะฝะบัะธะธ ัะฐะฑะพัั ั ะะ
- โ ะฃะฟัะพัะฐะตั ัะฐะทะฒะตัััะฒะฐะฝะธะต
- โ ะฃะผะตะฝััะฐะตั "ะฒะตั" ะฟัะพะณัะฐะผะผั
- โ ะฃะปัััะฐะตั ะปะพะณะธัะพะฒะฐะฝะธะต

**ะกัะฐััั:** โ ะะะขะะะ ะ ะะกะะะะฌะะะะะะะฎ

---

**ะะฒัะพั:** AI ะััะธััะตะฝั (Cursor)  
**ะะฐัะฐ:** 2025-12-17  
**ะะตััะธั ัะธััะตะผั:** 1.4.24

