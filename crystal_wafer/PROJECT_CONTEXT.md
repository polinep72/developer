# Контекст проекта Soft_IPK

## Описание
Многоуровневая сборка внутренних инструментов Soft_IPK, объединяющая несколько веб‑приложений и сервисов (Python/Poetry, Node.js, вспомогательные утилиты). Приложения обслуживают разные рабочие сценарии (управление заказами, чат‑боты, аналитические панели, экспорт данных).

## Версия
**Текущая версия: 1.4.23** (обновлено: 2025-12-17)

## Основные компоненты
- `backend/` — основной Python‑бэкенд (Poetry), вероятно реализует API/авторизацию.
- `frontend/` — отдельный Node.js фронтенд (React/Vite или аналогичный SPA).
- `web_app_WebChip/` — Flask веб-приложение для управления складом кристаллов и пластин:
  - Система управления тремя типами складов: Склад кристаллов, Склад пластин, Дальний склад
  - Функциональность поиска, прихода, расхода, возврата, инвентаризации
  - Корзина покупок с разделением по типам складов
  - Экспорт данных в Excel
  - HTML шаблоны в `templates/`
- `web_app_dash/`, `T-Helper/` — дополнительные сервисы (dash-приложение, помощник с FAISS).
- `telegram_bot_HMCB/` — устаревший отдельный телеграм-бот (интегрирован в `web_app_WebChip`)
- `docker-compose.yml`, `Dockerfile` — корневые конфигурации развёртывания.

## Текущий статус
- Структура репозитория подтверждена, контекстные файлы созданы.
- Реализована полная поддержка работы с несколькими складами.
- Приложение работает на порту 8089 для тестирования.

## Архитектура базы данных
- **Склад кристаллов**: таблицы `invoice`, `consumption`
- **Склад пластин**: таблицы `invoice_p`, `consumption_p`
- **Дальний склад**: таблицы `invoice_f`, `consumption_f`
- **Корзина**: таблица `cart` с поддержкой `warehouse_type` для разделения по складам

## Основные функции web_app_WebChip
1. **Поиск** - поиск кристаллов по различным критериям с фильтрацией
2. **Приход** - загрузка данных о поступлении товара из Excel
3. **Расход** - загрузка данных о расходе товара из Excel
4. **Возврат** - загрузка данных о возврате товара из Excel
5. **Инвентаризация** - сводная информация по остаткам с фильтрацией
6. **Корзина** - управление отобранными товарами с возможностью экспорта

## Ключевые настройки и зависимости
- Python‑проекты используют Poetry (`pyproject.toml` в корне и в `backend/`).
- Несколько Docker Compose файлов для отдельных сервисов, что указывает на микросервисный деплой.
- `web_app_WebChip` использует Flask с HTML шаблонами в `templates/` и Jinja2.
- База данных: PostgreSQL (подключение через `psycopg2`)

## Архитектура и связи
- Веб‑приложения могут обмениваться данными через общий API (`backend/`).
- Общие ресурсы: БД/файлы экспорта (`web_app_WebChip/exported_files`, `temp`).
- Telegram боты и вспомогательные сервисы используют собственные Docker‑окружения, но могут потреблять тот же API/БД.

## Последние изменения (v1.4.23)

- Интеграция телеграм-бота в основное Flask приложение (v1.4.23)
- Улучшение форматирования вывода в телеграм-боте с разделителями (v1.4.23)
- Исправление ошибок с инициализацией пула подключений и SQL запросами (v1.4.23)
- Docker deployment для объединенного приложения (v1.4.23)

### Предыдущие изменения (v1.4.22)

### Безопасность
- Хеширование паролей (v1.3.6)
- CSRF защита (v1.4.0)
- Rate Limiting (v1.4.1)
- Валидация входных данных и защита от SQL Injection/XSS (v1.4.0, v1.4.3)
- Audit Logging (v1.4.2)
- Защита от перечисления пользователей (v1.4.5)
- Восстановление пароля через секретный вопрос (v1.3.6)

### UX/UI улучшения
- Автодополнение шифров кристаллов (v1.4.8)
- Индикаторы загрузки (v1.4.9)
- Клавиатурные сокращения (v1.4.11)
- Подтверждения для критичных действий (v1.4.12)
- Пагинация результатов поиска (v1.4.17)

### Производительность
- Пул подключений к БД (v1.4.14)
- Кэширование справочных данных (v1.4.15)
- Индексы БД (v1.4.16)
- Оптимизация запросов (v1.4.18)

### API и документация
- REST API endpoints (v1.4.19)
- Расширенное логирование и мониторинг (v1.4.21)
- Полная документация (API, пользователя, развертывание) (v1.4.22)
- Тестирование (pytest, 29 тестов) (v1.4.20)

### Статус
- **Готовность к production:** ✅ ГОТОВО
- **Выполнение задач:** 89% (24 из 27)
- **Мобильная версия:** Не требуется (используется Telegram бот)
- **Интернационализация:** Отложена (все сотрудники русскоязычные)

