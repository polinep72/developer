2025-08-15 08:00:44 - BookingBot - DEBUG - [config.py:18] - .env файл найден и загружен из /app/.env
2025-08-15 08:00:44 - BookingBot - INFO - [config.py:79] - Базовая конфигурация успешно загружена и проверена.
2025-08-15 08:00:44 - BookingBot - DEBUG - [config.py:81] - Параметры БД: Host=192.168.1.139, Port=5432, DBName=CR, User=postgres
2025-08-15 08:00:44 - BookingBot - DEBUG - [config.py:82] - Часовой пояс планировщика: Europe/Moscow
2025-08-15 08:00:45 - BookingBot - INFO - [bot_app.py:17] - Инициализация общих компонентов приложения (bot, db_instance, scheduler)...
2025-08-15 08:00:50 - BookingBot - INFO - [bot_app.py:23] - Экземпляр бота создан успешно. ID: 8138321509, Имя: Conference_Room_Booking, Username: Conf_Room_Booking_bot
2025-08-15 08:00:50 - BookingBot - INFO - [bot_app.py:30] - Экземпляр Database создан (пул НЕ инициализирован).
2025-08-15 08:00:50 - BookingBot - INFO - [bot_app.py:50] - APScheduler JobStore URL: postgresql+psycopg2://postgres:****@192.168.1.139:5432/CR
2025-08-15 08:00:50 - BookingBot - INFO - [bot_app.py:71] - Планировщик APScheduler инициализирован с SQLAlchemyJobStore. Таймзона: Europe/Moscow
2025-08-15 08:00:50 - BookingBot - DEBUG - [bot_app.py:82] - Хранилища active_timers и scheduled_jobs_registry инициализированы.
2025-08-15 08:00:50 - BookingBot - INFO - [bot_app.py:84] - Общие компоненты приложения инициализированы.
2025-08-15 08:00:50 - BookingBot - INFO - [admin_commands.py:290] - Обработчики админ-команд успешно зарегистрированы.
2025-08-15 08:00:50 - BookingBot - INFO - [main.py:84] - --- Запуск приложения CRB v.1.0.0 ---
2025-08-15 08:00:50 - BookingBot - INFO - [main.py:94] - Инициализация пула БД...
2025-08-15 08:00:50 - BookingBot - INFO - [database.py:42] - Инициализация пула соединений с БД PostgreSQL (min=1, max=5)...
2025-08-15 08:00:50 - BookingBot - INFO - [database.py:57] - Пул соединений создан. Попытка тестового подключения...
2025-08-15 08:00:50 - BookingBot - DEBUG - [database.py:129] - Соединение 129818106425920 получено из пула.
2025-08-15 08:00:50 - BookingBot - INFO - [database.py:66] - Тестовое соединение успешно получено. Версия PostgreSQL: 170004
2025-08-15 08:00:50 - BookingBot - DEBUG - [database.py:72] - Тестовая транзакция отменена (rollback).
2025-08-15 08:00:50 - BookingBot - DEBUG - [database.py:148] - Соединение 129818106425920 возвращено в пул.
2025-08-15 08:00:50 - BookingBot - INFO - [database.py:75] - Пул соединений успешно инициализирован и готов к работе.
2025-08-15 08:00:50 - BookingBot - INFO - [main.py:97] - Пул БД инициализирован.
2025-08-15 08:00:50 - BookingBot - DEBUG - [main.py:100] - Проверка соединения...
2025-08-15 08:00:50 - BookingBot - DEBUG - [database.py:129] - Соединение 129818106425920 получено из пула.
2025-08-15 08:00:50 - BookingBot - DEBUG - [main.py:109] - Соединение ОК. Статус: 1
2025-08-15 08:00:50 - BookingBot - DEBUG - [database.py:148] - Соединение 129818106425920 возвращено в пул.
2025-08-15 08:00:50 - BookingBot - DEBUG - [main.py:119] - Тестовое соединение возвращено в пул.
2025-08-15 08:00:50 - BookingBot - INFO - [main.py:122] - Регистрация обработчиков...
2025-08-15 08:00:50 - BookingBot - INFO - [user_commands.py:272] - Обработчики команд пользователя успешно зарегистрированы.
2025-08-15 08:00:50 - BookingBot - INFO - [callback_handlers.py:230] - Основной обработчик callback-запросов успешно зарегистрирован.
2025-08-15 08:00:50 - BookingBot - INFO - [registration.py:229] - Обработчики регистрации (/start) зарегистрированы.
2025-08-15 08:00:50 - BookingBot - INFO - [main.py:133] - Обработчики зарегистрированы.
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:142] - Команды меню установлены.
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:158] - Планировщик запущен (состояние: 1).
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:159] - Планировщик использует timezone: Europe/Moscow
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:160] - Первоначальное планирование уведомлений...
2025-08-15 08:00:51 - BookingBot - INFO - [notification_service.py:121] - === Начало полного перепланирования уведомлений ===
2025-08-15 08:00:51 - BookingBot - DEBUG - [notification_service.py:127] - Найдено 0 ключей для удаления: set()
2025-08-15 08:00:51 - BookingBot - DEBUG - [database.py:129] - Соединение 129818106425920 получено из пула.
2025-08-15 08:00:51 - BookingBot - DEBUG - [database.py:217] - Выполнение запроса [SELECT] на соед. 129818106425920: SELECT b.id, b.user_id, b.cr_id, b.time_start, b.time_end, cr.cr_name
        FROM bookings b
        JOIN conferenceroom cr ON b.cr_id = cr.id
        WHERE b.status IN ('pending_confirmation', 'confirmed', 'active')
        AND b.time_end > %s
        ORDER BY b.id;... Параметры: (datetime.datetime(2025, 8, 15, 8, 0, 51, 80325),)
2025-08-15 08:00:51 - BookingBot - DEBUG - [database.py:220] - Запрос [SELECT] выполнен на соед. 129818106425920.
2025-08-15 08:00:51 - BookingBot - DEBUG - [database.py:249] - Запрос [SELECT] на соед. 129818106425920 вернул 0 строк.
2025-08-15 08:00:51 - BookingBot - DEBUG - [database.py:148] - Соединение 129818106425920 возвращено в пул.
2025-08-15 08:00:51 - BookingBot - DEBUG - [booking_service.py:808] - Найдено 0 броней для планирования уведомлений.
2025-08-15 08:00:51 - BookingBot - INFO - [notification_service.py:137] - Нет броней для планирования уведомлений.
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:165] - Первоначальное планирование завершено.
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:176] - Запуск polling...
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:181] - Запуск polling #1...
2025-08-15 08:00:51 - BookingBot - INFO - [main.py:189] - Параметр skip_pending = True
