<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}ChipDip –ü–∞—Ä—Å–µ—Ä{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Bootstrap –∏–ª–∏ –¥—Ä—É–≥–æ–π CSS —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ -->
</head>
<body>
    <nav>
        <div class="nav-left">
            <a href="{{ url_for('main.index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('main.my_products') }}">–ú–æ–∏ —Ç–æ–≤–∞—Ä—ã</a>
                <a href="{{ url_for('main.add_product') }}">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
            {% endif %}
        </div>
        <div class="nav-right">
            <div class="user-menu">
                {% if current_user.is_authenticated %}
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <i class="user-icon">üë§</i>
                        <span class="username">{{ current_user.username }}</span>
                        <i class="dropdown-arrow">‚ñº</i>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item">
                            <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ current_user.username }}</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="{{ url_for('auth.logout') }}" class="dropdown-item">
                            <i class="logout-icon">üö™</i>
                            –í—ã–π—Ç–∏
                        </a>
                    </div>
                {% else %}
                    <div class="user-info" onclick="toggleUserDropdown()">
                        <i class="user-icon">üë§</i>
                        <span class="username">–í–æ–π—Ç–∏</span>
                        <i class="dropdown-arrow">‚ñº</i>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item">
                            <span>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <form method="POST" action="{{ url_for('auth.login') }}" class="login-form">
                            <div class="form-group">
                                <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω" required>
                            </div>
                            <div class="form-group">
                                <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-small">–í–æ–π—Ç–∏</button>
                        </form>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item">
                            <span>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span>
                        </div>
                        <button onclick="showRegisterForm()" class="dropdown-item btn-link">
                            –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>
    <hr>
    <div class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </div>
    <footer>
        <p>¬© {{ current_year }} ChipDip Parser App</p>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRegisterModal()">&times;</span>
            <div class="auth-form-container">
                <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <form method="POST" action="{{ url_for('auth.register') }}">
                    <div class="form-group">
                        <label for="register-username">–õ–æ–≥–∏–Ω:</label>
                        <input type="text" id="register-username" name="username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-email">Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                        <input type="email" id="register-email" name="email">
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="register-password" name="password" required>
                        <small>–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-confirm-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="register-confirm-password" name="confirm_password" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    {% block scripts %}{% endblock %}
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            if (!event.target.matches('.user-info') && !event.target.matches('.user-icon') && !event.target.matches('.username') && !event.target.matches('.dropdown-arrow')) {
                const dropdowns = document.getElementsByClassName('user-dropdown');
                for (let dropdown of dropdowns) {
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function showRegisterForm() {
            document.getElementById('registerModal').style.display = 'block';
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
            document.getElementById('userDropdown').classList.remove('show');
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('registerModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('registerModal');
                if (modal.style.display === 'block') {
                    modal.style.display = 'none';
                }
            }
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>