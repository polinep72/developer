# Changelog

Все важные изменения в проекте ChipDip будут документированы в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
и проект следует [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- Расширенная аналитика с 6 интерактивными графиками
- График продаж по убыванию (топ-20 товаров)
- График продаж по месяцам для всех товаров (stacked bar chart)
- График выручки по месяцам для всех товаров (stacked bar chart)
- График остатков на складе для выбранного товара (line chart)
- График стоимости для выбранного товара (line chart)
- График продаж по месяцам для выбранного товара (line chart)
- График выручки по месяцам для выбранного товара (bar chart)
- Экспорт всех графиков в Excel с диаграммами
- Интерактивные легенды для графиков (включение/выключение товаров)
- Многопользовательская система с разделением товаров по пользователям
- Редактирование названий товаров в личном кабинете
- API endpoints для всех графиков и экспорта
- Использование Plotly.js для интерактивных графиков
- Использование openpyxl для экспорта в Excel
- Использование python-pptx для экспорта в PowerPoint

### Changed
- Переход с Chart.js на Plotly.js для более интерактивных графиков
- Улучшена структура страницы статистики
- Оптимизированы SQL запросы для расчета продаж и выручки
- Улучшена обработка ошибок в парсере
- Добавлена проверка соединения с БД в парсере

### Fixed
- Исправлена ошибка "connection already closed" в парсере
- Исправлена ошибка с NULL значениями в stock_level
- Исправлена проблема с "frozen transaction time" в PostgreSQL
- Исправлены ошибки создания Excel файлов с графиками
- Исправлена сортировка дат в экспортируемых графиках (по возрастанию)
- Исправлены типы графиков в Excel экспорте (LineChart для временных рядов)

### Technical
- Добавлены новые API endpoints:
  - `/api/stats/revenue/monthly` - данные выручки по месяцам
  - `/api/stats/revenue/product-monthly` - данные выручки для товара
  - `/api/export/chart/sales/excel` - экспорт графика продаж
  - `/api/export/chart/monthly/excel` - экспорт графика продаж по месяцам
  - `/api/export/chart/revenue/excel` - экспорт графика выручки
  - `/api/export/chart/stock/excel` - экспорт графика остатков
  - `/api/export/chart/price/excel` - экспорт графика цен
  - `/api/export/chart/product-monthly/excel` - экспорт графика продаж товара
  - `/api/export/chart/product-revenue/excel` - экспорт графика выручки товара
  - `/api/update/product-name/<int:product_id>` - обновление названия товара
- Обновлены зависимости: добавлены openpyxl, python-pptx
- Улучшена архитектура веб-интерфейса с модульной структурой

## [Unreleased]

### Added
- Публичные API для графиков статистики:
  - `GET /api/stats/revenue/monthly` — данные для графика 3 (выручка, все товары)
  - `GET /api/stats/revenue/product-monthly?product_id=...` — данные для графика 6 (выручка по товару)
- Health‑эндпоинты для мониторинга: `GET /health`, `GET /api/health`, резервный `GET /healthz`

### Fixed
- Убрана авторизация на экспорт‑эндпоинтах и API выручки (устранены 401)
- Исправлено отсутствие маршрутов (404) путём пересоздания контейнера `webapp` на свежем образе

### Ops
- Добавлены инструкции по пересборке/перезапуску и просмотру логов в PowerShell (без `&&`)

## [1.0.0] - 2025-10-24

### Added
- Базовая функциональность парсера ChipDip
- Docker-контейнеризация
- Веб-интерфейс для управления
- PostgreSQL интеграция
- Планировщик задач
- Логирование и мониторинг
