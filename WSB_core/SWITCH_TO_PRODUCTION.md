# Инструкция по переключению на боевую БД

## Текущее состояние

✅ **Боевая БД (192.168.1.139) полностью готова к переключению!**

Проверка показала, что в боевой БД уже есть:
- ✅ Столбец `status` в таблице `bookings`
- ✅ Столбцы `email`, `phone`, `password_hash` в таблице `users`
- ✅ Таблицы `wsb_time_slots` и `wsb_notifications_schedule`
- ✅ Все необходимые индексы

## Процедура переключения

### 1. Проверка готовности (опционально)

Перед переключением можно запустить проверку:

```bash
python scripts/check_production_db.py
```

### 2. Изменение настроек в .env

Измените в файле `.env`:

```env
# Было (тестовая БД):
DB_HOST=192.168.1.22
DB_NAME=RM

# Станет (боевая БД):
DB_HOST=192.168.1.139
DB_NAME=RM
```

### 3. Перезапуск сервисов

После изменения `.env` перезапустите:

**Бот:**
```powershell
# Остановить текущий процесс бота
# Затем запустить заново
cd C:\Soft_IPK\WSB_core\wsb_bot
python main.py
```

**Портал:**
```powershell
# Остановить текущий процесс портала
# Затем запустить заново
cd C:\Soft_IPK\WSB_core\wsb_portal
python -m uvicorn app.main:app --reload
```

### 4. Проверка работы

После перезапуска проверьте:

1. **Бот:**
   - Отправьте команду `/start` в Telegram
   - Убедитесь, что бот находит вас в БД
   - Проверьте, что команды работают корректно

2. **Портал:**
   - Откройте веб-интерфейс
   - Проверьте подключение к БД
   - Убедитесь, что данные отображаются корректно

## Важные замечания

### Различия между тестовой и боевой БД

1. **Тестовая БД (192.168.1.22):**
   - Содержит тестовые данные
   - Используется для разработки и тестирования
   - Может содержать дополнительные столбцы (например, `group_id` в `bookings`)

2. **Боевая БД (192.168.1.139):**
   - Содержит реальные данные пользователей
   - Используется в продакшене
   - Структура полностью синхронизирована с тестовой БД

### Что НЕ нужно делать

- ❌ Не нужно применять `sync_to_production.sql` - структура уже актуальна
- ❌ Не нужно создавать таблицы вручную - они уже существуют
- ❌ Не нужно добавлять столбцы - они уже есть

### Что нужно сделать

- ✅ Просто изменить `DB_HOST` в `.env`
- ✅ Перезапустить сервисы
- ✅ Проверить работу

## Откат на тестовую БД

Если нужно вернуться на тестовую БД:

1. Измените в `.env`:
   ```env
   DB_HOST=192.168.1.22
   ```

2. Перезапустите сервисы

## Скрипты для проверки

- `scripts/check_production_db.py` - проверка готовности боевой БД
- `scripts/sync_to_production.sql` - SQL-скрипт синхронизации (если понадобится в будущем)

## История изменений

- **2025-12-05**: Проверена готовность боевой БД - все структуры на месте
- **2025-12-05**: Создана инструкция по переключению

