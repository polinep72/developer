# WSB_core — единое ядро бронирования

## Назначение
`WSB_core` — это подпроект, в котором будет храниться **общее ядро логики бронирований** для всего WSB‑стека:
- общие модели (пользователи, оборудование, бронирования, статусы);
- общие функции работы с временными слотами и проверкой конфликтов;
- общие правила уведомлений (когда напоминать, как считать продления);
- общие утилиты для работы со временем и БД.

Цель: чтобы и Telegram‑бот (`WSB/wsb_bot`), и веб‑портал (`WSB_portal`) опирались на один и тот же код ядра, а не дублировали логику.

## Связанные подпроекты
- `WSB/` — основной Telegram‑бот (версия 5.1.0).
- `WSB_portal/` — веб‑портал бронирования (версия 0.3.7).
- `telegram_bot_WorkSpaceBooking/` — исторический бот на CSV (источник бизнес‑правил и сценариев).

## Текущая структура проекта

```
WSB_core/
├── wsb_core/              # Общее ядро логики
│   ├── models.py         # Общие модели (User, Equipment, Booking, TimeSlot)
│   ├── constants.py       # Общие константы (WORKING_HOURS_START, BOOKING_TIME_STEP_MINUTES)
│   └── slots.py           # Генерация слотов, работа с wsb_time_slots
├── wsb_bot/              # Копия Telegram бота (из WSB/)
│   ├── main.py
│   ├── bot_app.py
│   ├── config.py
│   ├── constants.py
│   ├── database.py
│   ├── handlers/         # Обработчики команд и callback'ов
│   ├── services/         # Бизнес-логика (booking_service, equipment_service, notification_service)
│   └── utils/            # Утилиты (keyboards, message_utils, time_utils)
├── wsb_portal/           # Копия веб-портала (из WSB_portal/)
│   ├── app/
│   │   ├── main.py       # FastAPI приложение
│   │   ├── services/     # Бизнес-логика (bookings, heatmap, dashboard, equipment)
│   │   ├── static/       # CSS, JS, изображения
│   │   └── templates/    # HTML шаблоны
│   ├── Dockerfile
│   └── requirements.txt
├── core_app/             # Тестовое FastAPI приложение для проверки wsb_core
├── scripts/               # Скрипты для работы с БД (создание таблиц, отладка)
└── docker-compose.yml    # Docker Compose для запуска всего стека
```

## Статус проекта

**Текущая версия:** 0.1.0 (начальная версия после копирования файлов)

**Важно:** 
- Боевые версии `WSB/` и `WSB_portal/` больше не изменяются
- Вся разработка ведется только в `WSB_core/`
- После стабилизации `WSB_core` будет развернут как замена боевых версий

## План работ

1. ✅ Скопировать все необходимые файлы из `WSB/` и `WSB_portal/` в `WSB_core/`
2. ✅ Адаптировать импорты в скопированных файлах для работы с `wsb_core`
3. ✅ Унифицировать константы через `wsb_core.constants`
4. ✅ Унифицировать логику генерации слотов через `wsb_core.slots`
5. ✅ Расширить модели бронирования в `wsb_core.models` (Booking, BookingStatus, функции преобразования)
6. ⏳ Унифицировать логику бронирований между ботом и порталом (создан `wsb_core/bookings_core`, портал уже подключен, остался бот)
7. ⏳ Вынести общие правила уведомлений в `wsb_core/notifications_logic.py`
8. ⏳ Протестировать работу бота и портала из `WSB_core`
9. ⏳ После стабилизации — развернуть `WSB_core` как замену боевых версий

Этот файл будет дополняться по мере развития ядра.
