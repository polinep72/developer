# WSB_core ‚Äî –µ–¥–∏–Ω–æ–µ —è–¥—Ä–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
`WSB_core` ‚Äî —ç—Ç–æ –ø–æ–¥–ø—Ä–æ–µ–∫—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è **–æ–±—â–µ–µ —è–¥—Ä–æ –ª–æ–≥–∏–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π** –¥–ª—è –≤—Å–µ–≥–æ WSB‚Äë—Å—Ç–µ–∫–∞:
- –æ–±—â–∏–µ –º–æ–¥–µ–ª–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Å—Ç–∞—Ç—É—Å—ã);
- –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤;
- –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–∫–æ–≥–¥–∞ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å, –µ–¥–∏–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã);
- –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –∏ –ë–î.

–¶–µ–ª—å: —á—Ç–æ–±—ã –∏ Telegram‚Äë–±–æ—Ç (`WSB/wsb_bot`), –∏ –≤–µ–±‚Äë–ø–æ—Ä—Ç–∞–ª (`WSB_portal`) –æ–ø–∏—Ä–∞–ª–∏—Å—å –Ω–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–¥ —è–¥—Ä–∞, –∞ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏ –ª–æ–≥–∏–∫—É.

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–¥–ø—Ä–æ–µ–∫—Ç—ã
- `WSB/` ‚Äî –±–æ–µ–≤–æ–π Telegram‚Äë–±–æ—Ç (–≤–µ—Ä—Å–∏—è 5.1.0).
- `WSB_portal/` ‚Äî –±–æ–µ–≤–æ–π –≤–µ–±‚Äë–ø–æ—Ä—Ç–∞–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–≤–µ—Ä—Å–∏—è 0.3.8, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –∏ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è).
- `telegram_bot_WorkSpaceBooking/` ‚Äî –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –±–æ—Ç –Ω–∞ CSV (–∏—Å—Ç–æ—á–Ω–∏–∫ –±–∏–∑–Ω–µ—Å‚Äë–ø—Ä–∞–≤–∏–ª –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤).

## –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
WSB_core/
‚îú‚îÄ‚îÄ wsb_core/               # –û–±—â–µ–µ —è–¥—Ä–æ –ª–æ–≥–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # –û–±—â–∏–µ –º–æ–¥–µ–ª–∏ (User, Equipment, Booking, TimeSlot, BookingStatus)
‚îÇ   ‚îú‚îÄ‚îÄ constants.py        # –û–±—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (WORKING_HOURS_START, WORKING_HOURS_END, BOOKING_TIME_STEP_MINUTES, MAX_BOOKING_DURATION_HOURS)
‚îÇ   ‚îú‚îÄ‚îÄ slots.py            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤, —Ä–∞–±–æ—Ç–∞ —Å wsb_time_slots
‚îÇ   ‚îú‚îÄ‚îÄ bookings_core.py    # –ï–¥–∏–Ω–∞—è –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (create/cancel/extend, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ notifications_logic.py # –ï–¥–∏–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–∫–æ–≥–¥–∞ —Å–ª–∞—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ, TZ)
‚îú‚îÄ‚îÄ wsb_bot/                # –ö–æ–ø–∏—è Telegram‚Äë–±–æ—Ç–∞ (–∏–∑ WSB/), –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ —è–¥—Ä–æ
‚îÇ   ‚îú‚îÄ‚îÄ main.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞ WSB_core
‚îÇ   ‚îú‚îÄ‚îÄ config.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ .env –∏–∑ –∫–æ—Ä–Ω—è WSB_core
‚îÇ   ‚îú‚îÄ‚îÄ constants.py        # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –±–æ—Ç–∞ (—Ç–µ–∫—Å—Ç—ã, callback‚Äë–∫–æ–¥—ã), —á–∞—Å—Ç—å —Ç—è–Ω–µ—Ç—Å—è –∏–∑ wsb_core.constants
‚îÇ   ‚îú‚îÄ‚îÄ database.py         # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ handlers/           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback'–æ–≤ (user_commands, admin_commands, callback_handlers, registration)
‚îÇ   ‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ (booking_service, equipment_service, user_service, notification_service –∏ –¥—Ä.)
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã (keyboards, message_utils, time_utils)
‚îú‚îÄ‚îÄ wsb_portal/             # –ö–æ–ø–∏—è –≤–µ–±‚Äë–ø–æ—Ä—Ç–∞–ª–∞ (–∏–∑ WSB_portal/), –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ —è–¥—Ä–æ
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py         # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ—Ä—Ç–∞–ª WSB_core, –ø–æ—Ä—Ç 8088)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ (bookings, heatmap, dashboard, equipment, notifications)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ static/         # CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/      # HTML‚Äë—à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ core_app/               # –¢–µ—Å—Ç–æ–≤–æ–µ FastAPI‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —è–¥—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ scripts/                # –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –æ—Ç–ª–∞–¥–∫–∞)
‚îú‚îÄ‚îÄ PROJECT_CONTEXT.md      # –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îú‚îÄ‚îÄ SOLUTIONS_HISTORY.md    # –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ CHANGELOG.md            # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞ (SemVer)
‚îú‚îÄ‚îÄ CHAT_HISTORY.md         # –°–∂–∞—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –ø–æ WSB_core
‚îî‚îÄ‚îÄ docker-compose.yml      # Docker Compose –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞ (–ø–æ–∫–∞ –Ω–µ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω)
```

## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è —è–¥—Ä–∞:** 1.0.4 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫)

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ë–æ–µ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ `WSB/` –∏ `WSB_portal/` **–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã** –∏ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è.
- –í—Å—è –Ω–æ–≤–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –≤–µ–¥—É—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ `WSB_core/`**.
- –Ø–¥—Ä–æ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞: –º–æ–¥–µ–ª–∏, —Å–ª–æ—Ç—ã, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –ª–æ–≥–∏–∫—É create/cancel/extend, –ø—Ä–∞–≤–∏–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
- –ë–æ—Ç –∏ –ø–æ—Ä—Ç–∞–ª –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —è–¥—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–æ–µ–≤–æ–≥–æ –∫–æ–¥–∞.

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

- **–ú–æ–¥–µ–ª–∏ (`wsb_core.models`):**
  - `BookingStatus` —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ –ø–æ `cancel/finish/time_end`, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ `status` –≤ –ë–î.
  - `Booking` —Å –ø–æ–ª—è–º–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ –ë–î (`cancel`, `finish`, `time_interval`, `duration`, `data_booking`, `user_fio`, `equipment_name`, `date`).
  - –§—É–Ω–∫—Ü–∏–∏ `determine_booking_status()` –∏ `booking_from_db_row()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ —Å—ã—Ä—ã—Ö —Å—Ç—Ä–æ–∫ –ë–î.

- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`wsb_core.constants`):**
  - –†–∞–±–æ—á–∏–π –¥–µ–Ω—å: 07:00‚Äì22:00.
  - –®–∞–≥ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: 30 –º–∏–Ω—É—Ç.
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–π –±—Ä–æ–Ω–∏: 8 —á–∞—Å–æ–≤.
  - –ë–æ—Ç –∏ –ø–æ—Ä—Ç–∞–ª –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç, –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback.

- **–°–ª–æ—Ç—ã (`wsb_core.slots`):**
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–Ω–µ–≤–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π `wsb_time_slots`.
  - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `calculate_available_slots_from_bookings()` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –ø–æ —Å–ø–∏—Å–∫—É –±—Ä–æ–Ω–µ–π.
  - –ü–æ—Ä—Ç–∞–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `wsb_time_slots`, –±–æ—Ç ‚Äî —Ä–∞—Å—á—ë—Ç –ø–æ –±—Ä–æ–Ω—è–º; –ª–æ–≥–∏–∫–∞ —à–∞–≥–æ–≤ –∏ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –æ–±—â–∞—è.

- **–Ø–¥—Ä–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (`wsb_core.bookings_core`):**
  - `create_booking_core`: –µ–¥–∏–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω, —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã), –≤—Å—Ç–∞–≤–∫–∞ –≤ `bookings`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è `wsb_time_slots`.
  - `cancel_booking_core`: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤, —Å—Ç–∞—Ç—É—Å–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `cancel = TRUE`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤.
  - `extend_booking_core`: –µ–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è (–ø—Ä–∞–≤–∞, —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å, –æ–±—â–∏–π –ª–∏–º–∏—Ç MAX_DURATION, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `time_end/time_interval/duration/extension`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `wsb_time_slots`).
  - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `BookingCoreResult` —Å –ø–æ–ª–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º `Booking` –∏ —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π (`old_end/new_end`, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ —Ç.–ø.).

- **–ü–æ–ª–∏—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`wsb_core.notifications_logic`):**
  - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
    - `NOTIFICATION_BEFORE_START_MINUTES = 10` ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ.
    - `NOTIFICATION_BEFORE_END_MINUTES = 10` ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Å–∫–æ—Ä–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏.
    - `SCHEDULER_TIMEZONE = "Europe/Moscow"` ‚Äî –±–∞–∑–æ–≤–∞—è —Ç–∞–π–º–∑–æ–Ω–∞ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–∏.
  - –§—É–Ω–∫—Ü–∏–∏:
    - `is_booking_valid_for_start_notification(now, booking)` ‚Äî —Ä–µ—à–∞–µ—Ç, –µ—Å—Ç—å –ª–∏ —Å–º—ã—Å–ª —Å–ª–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ (–±—Ä–æ–Ω—å –∞–∫—Ç–∏–≤–Ω–∞, –µ—â—ë –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å, –æ–∫–Ω–æ –¥–æ –Ω–∞—á–∞–ª–∞ –Ω–µ –±–æ–ª—å—à–µ 10 –º–∏–Ω—É—Ç).
    - `is_booking_valid_for_end_notification(now, booking)` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –æ–∫–æ–Ω—á–∞–Ω–∏—è.
    - `can_offer_extension_on_end(booking, now, has_conflicts_in_extension_window, extension_step_minutes=None)` ‚Äî —Ä–µ—à–∞–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ü–µ (–±—Ä–æ–Ω—å –∞–∫—Ç–∏–≤–Ω–∞, –Ω–µ –≤—ã—à–ª–∏ –∑–∞ —Ä–∞–º–∫–∏ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è, –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–º —à–∞–≥–µ).
  - –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –±–∏–∑–Ω–µ—Å‚Äë—Ä–µ—à–µ–Ω–∏–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–±–æ—Ç –∏ –ø–æ—Ä—Ç–∞–ª).

- **–û—Ç–ø—Ä–∞–≤–∫–∞ email (`wsb_core.email_service`):**
  - –ú–æ–¥—É–ª—å `email_service.py` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ SMTP.
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SMTP —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ `.env` —á–µ—Ä–µ–∑ `app_config.py` (WSB_SMTP_HOST, WSB_SMTP_PORT, WSB_SMTP_USER, WSB_SMTP_PASSWORD, WSB_SMTP_FROM_EMAIL, WSB_SMTP_FROM_NAME, WSB_ENABLE_EMAIL).
  - –§—É–Ω–∫—Ü–∏—è `send_booking_created_notification()` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å HTML –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º.

- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (`wsb_core.booking_watcher`):**
  - –ú–æ–¥—É–ª—å `booking_watcher.py` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ë–î (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –±–æ—Ç) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ ID –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–µ–π.
  - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –±–æ—Ç —á–µ—Ä–µ–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥).

- **–ë–æ—Ç (`wsb_bot`) –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —è–¥—Ä–∞:**
  - –ö–æ–ø–∏—Ä—É–µ—Ç –±–æ–µ–≤—É—é –ª–æ–≥–∏–∫—É, –Ω–æ:
    - `services/booking_service.extend_booking` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `wsb_core.bookings_core.extend_booking_core` —Å fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.
    - –ö–æ–º–∞–Ω–¥–∞ `/extend` –∏ –∫–Ω–æ–ø–∫–∞ ¬´‚è≥ –ü—Ä–æ–¥–ª–∏—Ç—å –±—Ä–æ–Ω—å¬ª —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ –±–æ–µ–≤–æ–π `callback_handlers`, –Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `booking_service` —É–∂–µ –∑–∞–≤—è–∑–∞–Ω –Ω–∞ —è–¥—Ä–æ.
    - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã, –≥–¥–µ –ª–æ–≥–∏–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç–æ—è–ª–∞—Å—å (user_service, equipment_service –∏ –¥—Ä.), –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –∫ –±–æ–µ–≤—ã–º –º–æ–¥—É–ª—è–º.

- **–ü–æ—Ä—Ç–∞–ª (`wsb_portal`) –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —è–¥—Ä–∞:**
  - `app/services/bookings.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `create_booking_core`, `cancel_booking_core`, `extend_booking_core` –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ SQL.
  - –ö–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ–¥–ª–∏—Ç—å¬ª –Ω–∞ –≤–∫–ª–∞–¥–∫–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–¥—Ä–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è.
  - –õ–æ–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `app/services/notifications.py` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É e‚Äëmail –∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∏–∑ `wsb_core.notifications_logic`.

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã / –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –õ–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –±–æ—Ç–∞ –ø–æ‚Äë–ø—Ä–µ–∂–Ω–µ–º—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –±–æ–µ–≤–æ–º `services/notification_service.py` –∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –¥—É–±–ª—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏; —è–¥—Ä–æ –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª–∏—Ç–∏–∫–∏, –∞ –Ω–µ –∫–∞–∫ –ø–æ–ª–Ω—ã–π –∑–∞–º–µ–Ω–∏—Ç–µ–ª—å.
- E‚Äëmail‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Ä—Ç–∞–ª–∞ –∂–∏–≤—É—Ç –≤ `WSB_portal/app/services/notifications.py` –∏ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞–ø—Ä—è–º—É—é —Å APScheduler –±–æ—Ç–∞ (—ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π).
- Docker‚Äë–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `docker-compose.yml` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞+–ø–æ—Ä—Ç–∞–ª–∞+—è–¥—Ä–∞ –Ω–µ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.

## –ü–ª–∞–Ω —Ä–∞–±–æ—Ç (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π)

1. ‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –∏–∑ `WSB/` –∏ `WSB_portal/` –≤ `WSB_core/`.
2. ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `wsb_core`.
3. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ `wsb_core.constants`.
4. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ `wsb_core.slots`.
5. ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `wsb_core.models` (Booking, BookingStatus, —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è).
6. ‚úÖ –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω–æ–µ —è–¥—Ä–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π `wsb_core.bookings_core` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –ø–æ—Ä—Ç–∞–ª—É (create/cancel/extend).
7. ‚úÖ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤ –±–æ—Ç–µ –∏ –ø–æ—Ä—Ç–∞–ª–µ –Ω–∞ `wsb_core.bookings_core.extend_booking_core` (—Å fallback –≤ –±–æ—Ç–µ).
8. ‚úÖ –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ `wsb_core.notifications_logic`.
9. üîÑ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `wsb_core.notifications_logic` –≤ e‚Äëmail‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –ø–æ—Ä—Ç–∞–ª–∞ (–µ–¥–∏–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏).
   - ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `booking_reminders.py`
   - ‚ùå –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (`is_booking_valid_for_start_notification`, `is_booking_valid_for_end_notification`) –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `notification_worker.py`
10. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ –∏ –ø–æ—Ä—Ç–∞–ª–∞ –∏–∑ `WSB_core` –Ω–∞ –æ–¥–Ω–æ–º –∏ —Ç–æ–º –∂–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ ‚Üí –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤ –ø–æ—Ä—Ç–∞–ª–µ ‚Üí –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –≤ –±–æ—Ç–µ ‚Üí –æ—Ç–º–µ–Ω–∞).
    - ‚úÖ –ï—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    - ‚ùå –ù–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
11. üîÑ –ü–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Docker‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —è–¥—Ä–æ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ–µ–≤—ã—Ö —Å–∏—Å—Ç–µ–º.
    - ‚úÖ –ï—Å—Ç—å –±–∞–∑–æ–≤—ã–π `docker-compose.yml`
    - ‚ùå –°—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –±–æ–µ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ (`../WSB/`, `../WSB_portal/`) –≤–º–µ—Å—Ç–æ `WSB_core/`
    - ‚ùå –ù–µ—Ç Dockerfile –¥–ª—è `wsb_bot` –≤ `WSB_core`
    - ‚ùå –ù–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

**–õ–µ–≥–µ–Ω–¥–∞:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ | üîÑ –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ | ‚è≥ –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

**–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç:** —Å–º. `STATUS_REPORT.md`

–≠—Ç–æ—Ç —Ñ–∞–π–ª –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫—Ä—É–ø–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —è–¥—Ä–∞ (–Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏, —Å–º–µ–Ω–∞ —Å—Ö–µ–º—ã —Ä–∞–±–æ—Ç—ã, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–¥–ø—Ä–æ–µ–∫—Ç–æ–≤).
