# Telegram Bot для бронирования рабочих мест

Этот Telegram-бот позволяет пользователям бронировать, отменять и управлять бронированиями рабочих мест. Бот взаимодействует с пользователями через серию команд и кнопок инлайн-клавиатуры для упрощения процесса бронирования. Все бронирования сохраняются в БД RM на PostgreSQL сервере в таблице `bookings`.

## Возможности

- **Бронирование рабочего места**: пользователи могут бронировать рабочие места, выбирая конкретную дату, время и продолжительность работы.
- **Отмена бронирований**: пользователи могут отменять свои активные бронирования.
- **Просмотр активных бронирований**: бот отображает текущие бронирования пользователя и позволяет ими управлять.
- **Выбор рабочего места**: пользователи могут выбирать доступные рабочие места из списка.
- **Запись бронирований**: все бронирования сохраняются в таблице `bookings` и могут быть загружены или обновлены.
- **Оповещение**: Оповещение за 10 минут о начале и окончании работы на забронированном оборудовании.

## Команды

### `/view_equipment`
- просмотр оборудования

### `/add_equipment`
- добавление оборудования

### `/booking`
- Начинает процесс бронирования рабочего места.
- Пользователям предлагается выбрать рабочее место, дату (в пределах 7 дней от текущей даты), время начала и продолжительность работы.
- После выбора бот проверяет доступность рабочего места и подтверждает бронирование.
- Если рабочее место недоступно, пользователю будет предложено выбрать другое время.

### `/cancel`
- Отображает активные бронирования пользователя и позволяет отменить выбранное бронирование.
- Бот подтверждает отмену и сохраняет данные в файле `bookings.csv`.

### `/продлить`
- Бот отслеживает ваше текущее бронирование и позволяет продлить время работы на рабочем месте.
- Бот предлагает время на которое можно увеличить бронь и подтверждает продление и вносит данные о бронировании `bookings.csv`.
- В случае если время, на которое претендует пользователь будет занято, бот предложит согласовать изменение времени с другим пользователем.  

### `/finish`
- Окончание работы на зарезервированном РМ. По окончании работы на рабочем месте необходимо нажать на эту кнопку для того чтобы освободить время резервирования РМ.
- Бот отслеживает временной интервал и отображает активное бронирование пользователя и позволяет завершить работы по выбранному бронированию.
- Бот подтверждает окончание работы на рабочем месте, вносит данные по окончанию работы в `bookings.csv`.

### `/users`
 - просмотр зарегистрированных пользователей.

### `/allbookings`  
- просмотр всех резервирований.

### `/mybookings`  
- просмотр всех ваших резервирований.

### `/workspacebookings` 
- просмотр резервирований по рабочим местам.

### `/datebookings` 
- просмотр резервирований всех пользователей по всем рабочим местам на дату (недельный интервал).

### `/help`
 - вывод сообщение справки.

## Структура файлов

Бот взаимодействует с данными из БД RM, размещенных на PostgreSQL сервере (192.168.1.22).

Основная таблица `bookings` для хранения данных о бронированиях:
- **`bookings`**: содержит все активные бронирования в следующем формате:
  - `id`: Порядковый номер записи. 
  - `user_id`: ID пользователя Telegram, который сделал бронирование.
  - `equip_id`: ID забронированного рабочего места.
  - `date`: Дата бронирования в формате `DD-MM-YYYY`.
  - `time_interval`: Интервал времени бронирования в формате `HH:MM-HH:MM`.
  - `time_start`: Начало бронирования в формате `YYYY-MM-DD HH:MM:SS`.
  - `time_end`: Окончание бронирования в формате `YYYY-MM-DD HH:MM:SS`.
  - `duration`: Длительность времени бронирования в формате `1.0` в часах.
  - `cancel`: Отмена бронирования в формате `False`и `True` 
  - `extension`: Продление времени бронирования в формате `HH:MM`.
  - `finish`: Время окончания работ `YYYY-MM-DD HH:MM:SS`.
  - `data_booking`: Дата и время бронирования `YYYY-MM-DD HH:MM:SS`.

Вспомогательные таблицы:
`cat` для хранения данных о типе оборудования:
  - `id`: Идентификационный номер.
  - `name_cat`: Тип оборудования.

`equipment` для хранения данных о названии оборудования:
  - `id`: Идентификационный номер.
  - `category`: Идентификационный номер Тип оборудования.
  - `name_equip`: Название оборудования.
  - `note`: Примечание.

`users` для хранения данных о Пользователях:
  - `users_id`: Идентификационный номер.
  - `first_name`: Имя пользователя.
  - `last_name`: Фамилия пользователя.
  - `date`: Дата регистрации.
  - `fi`: Фамилия и Имя пользователя.



## Функции и процесс бронирования

### `Функция Help`
- Просмотр всех команд бота.

### `Функция для подключения к базе данных и выполнения запросов`
- Получение и отправка данных на сервер.

### `Функция просмотра списка оборудования /view_equipment`
- Загрузка данных  из таблицы `equipment`.
- Добавление данных `/add_equipment`.

### `Функция просмотра бронирований /mybookings, /allbookings, /datebookings и /workspacebookings')`
- Загрузка данных  из таблицы `bookings` в соответствии с типом запроса.

### `Функция просмотра пользователей /users`
- Загрузка данных  из таблицы `users`.

### `Функция запуска работы бота /start`
- Загрузка данных  из таблицы `users` и проверка на регистрцию.
- Регистрация пользователя c подтверждением у администратора и загрука данных  в таблицу `users`.

### `Функция отмены бронирования /cancel`
- Загрузка данных  из таблицы `bookongs` и проверка наличия брони.
- Отмена брони и  загрука данных  в таблицу `bookongs`.

### `Функция окончание бронирования /finish`
- Загрузка данных  из таблицы `bookongs` и проверка наличия брони.
- Окончание работы на оборудовании и  загрука данных  в таблицу `bookongs`.

### `Функция продления бронирования /продлить`
- Загрузка данных  из таблицы `bookongs` и проверка наличия брони.
- Продление работы на оборудовании и  загрука данных  в таблицу `bookongs`.

### `Функция расписания /schedule`
- Загрузка данных  из таблицы `bookongs` и проверка наличия брони.
- Создание расписания оповещений работы на оборудовании и  загрука данных  в таблицу `bookongs`.
- Отправка оповещения за 10 минут до начала и окончания работы на оборудовании Пользователю.

### `Функция для просмотра всех бронирований /all`
- Загрузка данных  из таблицы `bookongs` и проверка наличия брони.
- Отправка текстового файла с данными о бронировании по критериям (Пользователи, Оборудование, Даты(месяц)).

### `Функция бронирования /bookings`
- Позволяет выбрать пользователю оборудование, день и время для работы на оборудовании.
- Загружает данные из таблицы `bookings.csv`.
- Проверяет на совпадение по дате и времени.
- Перезаписывает обновлённые данные.

1. **Начало бронирования**:
   - Пользователь начинает бронирование с помощью команды `/booking`.
   - Бот показывает список доступных рабочих мест, и пользователь выбирает одно из них.
   
2. **Выбор даты**:
   - Бот предлагает список дат в пределах ближайших 7 дней.
   - Пользователь выбирает дату.
   
3. **Выбор времени**:
   - Бот предлагает выбрать время начала (с 08:00 до 20:00).
   - Пользователь выбирает время.

4. **Выбор продолжительности**:
   - Бот предлагает варианты продолжительности (от 00:30 до 08:00 с шагом в 30 минут).
   - Пользователь выбирает нужную продолжительность.
   
5. **Подтверждение**:
   - Бот проверяет доступность выбранного времени.
   - Если время доступно, бронирование сохраняется и подтверждается.
   - Если время недоступно, пользователю предлагается выбрать другое время.

## Процесс отмены

1. **Отмена бронирования**:
   - Пользователь использует команду `/cancel`.
   - Бот показывает список активных бронирований пользователя.
   
2. **Выбор бронирования для отмены**:
   - Пользователь выбирает бронирование, которое хочет отменить.
   - Бронирование помечается как отмененное в файле `bookings.csv` и подтверждается ботом.

## Процесс продления

**Продление бронирования**:
   - Пользователь использует команду `/продление`.
   - Бот показывает список доступного времени для продления бронирования.
   - Пользователь выбирает доступное время для продления бронирования.
   - Бронирование продляется, бот вносит врямя продления в  файл `bookings.csv`.
   - В случае если время занято, бот предлагает согласовать время с пользователем. 

## Процесс окончания работ на рабочем месте

**Продление бронирования**:
   - Пользователь использует команду `/finish`.
   - Бот отслеживает забронированное время на рабочем месте.
   - Продлить работу на рабочем месте можно только находясь внутри забронированного временного интервала.
   - Бронирование завершается, бот сохраняет запись бронированного врямени в файле `bookings.csv`.

## Установка

1. Клонируйте этот репозиторий:
   ```bash
   git clone https://github.com/your-repo/telegram-workspace-booking-bot.git
   ```

2. Установите необходимые библиотеки:
   ```bash
   pip install pandas
   pip install pyTelegramBotAPI
   pip install python-telegram-bot-calendar
   pip install schedule, apscheduler
   ```

3. Замените `YOUR_BOT_API_TOKEN` в файле .env на ваш реальный API токен Telegram Bot.

4. Запустите бота:
Через Меню «Выполнить» (Win-R)
Чтобы воспользоваться этим способом нужно нажать комбинацию клавиш Win-R на клавиатуре. После появления окна нужно ввести команду «cmd» и нажать на клавишу «Enter». После этого перед вами появляется черное окно с командной строкой Windows.
Набираете место где храниться ваш файл `cd C:\Users\******\Documents\telegram_bot_WorkSpaceBooking` и нажимаете «Enter».
Набираете `python WSBv5.1.py` и нажимаете «Enter». 
Поздравляю, бот запущен!

## Требования

- Python 3.x
- Библиотека `pyTelegramBotAPI`
- Библиотека `python-telegram-bot-calendar`
- Библиотека `pandas`
- Библиотека `python-telegram-bot-calendar`

## Файлы: 
`.env`
```
TELEGRAM_BOT_TOKEN="********************************"
POSTGRE_USER=**********
POSTGRE_PASSWORD=********
POSTGRE_DBNAME=********
ADMIN_ID=********
```

## Примечания

- Бот может работать с несколькими пользователями одновременно.
- Все бронирования проверяются на пересечения по времени, и бронирования с конфликтами времени для одного и того же рабочего места запрещены.
- Убедитесь, что все файлы имеют правильные разрешения на чтение/запись.

## Лицензия

- Проект распространяется под лицензией MIT. Подробнее: https://mit-license.org/.